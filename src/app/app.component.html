<main role="main">

	<section class="jumbotron text-center m-0">

		<div class="container">

			<h1 class="jumbotron-heading">
				Thumbnail Generator
			</h1>

			<p class="lead text-muted">
				On the left, you can authenticate yourself using your email-address and a code of choice.
				<br>
				Once authenticated, you can choose to upload a file, (click browse... -> select a file -> upload),
				or view the status of your requested thumbnails.
				<br>
				Once a thumbnail is generated, you will receive an email and they will be available for download for 7 days.
			</p>

			<form [formGroup]="uploadForm" (ngSubmit)="onFileUpload()">

				<div class="row">

					<div class="col border-right border-info">

						<div class="form-group text-left">

							<label for="userForm_email">
								Email:
							</label>
							<input
								class="form-control"
								id="userForm_email"
								type="email"
								formControlName="email"
							>

							<label for="userForm_code">
								Code:
							</label>
							<input
								class="form-control"
								id="userForm_code"
								type="email"
								formControlName="code"
							>

							<label for="slackForm">
								Slack:
							</label>
							<div class="input-group" id="slackForm">

								<div class="input-group-prepend">

									<span class="input-group-text" id="">
										Webhook
									</span>

								</div>

								<input
									class="form-control"
									id="slackForm_url"
									type="url"
									formControlName="slack_webhook"
								>

							</div>

						</div>

					</div>

					<div class="col align-self-end">

						<div class="form-group">

							<div class="input-group">

								<div class="input-group-prepend">
									<button
										class="btn btn-primary btn-sm"
										type="submit"
										#imageUploadButton
									>
										Upload!
									</button>
								</div>

								<div class="custom-file">
									<label
										class="custom-file-label"
										for="uploadForm_file"
										#imageUploadLabel
									> Choose an image. </label>
									<input
										type="file"
										class="custom-file-input"
										id="uploadForm_file"
										formControlName="image"
										(change)="onFileChanged($event)"
									>
								</div>

							</div>

						</div>

					</div>

				</div>

			</form>

		</div>

	</section>

	<ng-template [ngIf]="!requestedThumbnailData">

		<div class="container mt-5 mb-5">

			<div class="row justify-content-center align-items-center">

				<div class="input-group w-25">

					<button
						class="form-control btn-info"
						(click)="syncThumbnails()"
						#syncButton
					>
						Retrieve thumbnails
					</button>

					<div class="input-group-append">

						<span class="input-group-text">
							<fa-icon
								#syncStatus
								[icon]="faCloudDownload"
							></fa-icon>
						</span>

					</div>

				</div>

			</div>

		</div>

	</ng-template>

	<ng-template [ngIf]="requestState.requestSuccessful && !requestState.requestInProgress">

		<div class="album py-5 bg-light mh-100">

			<div class="container">

				<ng-container *ngFor="let thumbnail of thumbnailList; let idx = index;">

					<div class="row" *ngIf="idx%3 === 0">

						<ng-container *ngFor="let cardIdx of lodash.range(idx, lodash.min([thumbnailList.length, idx + 3]), 1)">

							<div class="col-md-4">

								<div class="card mb-4 box-shadow">

									<img
										class="card-img-top"
										alt="Thumbnail [100%x225]"
										style="height: 225px; width: 100%; display: block; object-fit: contain"
										[src]="thumbnailList[cardIdx].url"
									>

									<div class="card-body">

										<p class="card-text">
											{{ thumbnailList[cardIdx].key }}
										</p>

										<div class="d-flex justify-content-between align-items-center">

											<div class="btn-group">

												<button type="button" class="btn btn-sm btn-info btn-outline-secondary text-white" (click)="openImage(thumbnailList[cardIdx].url)">
													View
												</button>

												<button type="button" class="btn btn-sm btn-primary btn-outline-secondary text-white" (click)="downloadImage(thumbnailList[cardIdx])">
													Download
												</button>

												<button
													type="button"
													class="btn btn-sm btn-outline-secondary text-black-50 {{ thumbnailList[cardIdx].isProcessed? 'btn-primary': 'btn-danger'}}"
													disabled
												>
													Status: {{ thumbnailList[cardIdx].isProcessed? 'ready': 'not ready'}}
												</button>

											</div>

											<small class="text-muted">
												{{ cardIdx + 1 }} | {{ thumbnailList.length }}
											</small>

										</div>

									</div>

								</div>

							</div>

						</ng-container>

					</div>

				</ng-container>

			</div>

		</div>

	</ng-template>

</main>
